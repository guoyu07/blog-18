module.exports=function(e){var n={};function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t.w={},t(t.s=36)}([function(e,n,t){"use strict";var r=t(19);t.o(r,"Locale")&&t.d(n,"Locale",function(){return r.Locale});var o=t(18);t.d(n,"Locale",function(){return o.a});t(17),t(16),t(15),t(14),t(13)},function(e,n){e.exports=require("graphql-tag")},function(e,n){e.exports=require("axios")},function(e,n){e.exports=require("koa-session")},function(e,n){e.exports=require("koa-compose")},function(e,n){e.exports=require("koa")},function(e,n){e.exports=require("debug")},function(e,n){e.exports=require("date-fns/locale")},function(e,n){e.exports=require("date-fns")},function(e,n){e.exports=require("path")},function(e,n){e.exports=require("koa-static-cache")},function(e,n){e.exports=require("accept-language")},function(e,n){e.exports=require("fs")},function(e,n){},function(e,n){},function(e,n){},function(e,n){},function(e,n){},function(e,n,t){"use strict";var r,o;t.d(n,"a",function(){return r}),function(e){e.EN="en",e.ZH="zh"}(r||(r={})),function(e){e.user="user",e.organization="organization"}(o||(o={}))},function(e,n){},function(e,n){e.exports=require("invert-color")},function(e,n){e.exports=require("qs")},function(e,n){e.exports=require("google-translate-api")},function(e,n){e.exports=require("crypto")},function(e,n){e.exports=require("uuid")},function(e,n){e.exports=require("node-fetch")},function(e,n){e.exports=require("koa-router")},function(e,n){e.exports=require("koa-bodyparser")},function(e,n){e.exports=require("apollo-link-http")},function(e,n){e.exports=require("apollo-client")},function(e,n){e.exports=require("apollo-cache-inmemory")},function(e,n){e.exports=require("vue-server-renderer")},function(e,n){e.exports=require("lru-cache")},function(e,n){e.exports=require("koa-logger")},function(e,n){e.exports=require("koa-compress")},function(e,n){e.exports=require("koa-better-http-proxy")},function(e,n,t){"use strict";t.r(n);var r,o,a=t(12),i=t.n(a),c=t(11),u=t.n(c),s=t(6),l=t.n(s),f=t(5),p=t.n(f),d=t(35),h=t.n(d),v=t(4),g=t.n(v),b=t(34),y=t.n(b),x=t(33),w=t.n(x),E=t(3),m=t.n(E),T=t(10),_=t.n(T),O=t(32),q=t.n(O),k=t(31),L=t(9),I=t.n(L),A=+process.env.PORT||7e3,S=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return I.a.resolve.apply(I.a,[process.cwd()].concat(e))},N=require,R=t(30),C=t(29),P=t.n(C),G=t(28),j=t(2),H=t.n(j),U=t(1),B=t.n(U),D=t(27),M=t.n(D),z=t(26),K=t.n(z),Y=t(25),F=t.n(Y),Z=t(24),$=t.n(Z),W=t(23),X=t.n(W),V=t(22),J=t.n(V),Q=t(21),ee=t.n(Q),ne=t(20),te=(t.n(ne).a,t(0)),re=te.Locale.EN,oe=te.Locale.ZH,ae=((r={})[re]=oe,r[oe]=re,r),ie=(te.Locale.EN,[te.Locale.EN,te.Locale.ZH]),ce=(t(8),t(7)),ue=((o={})[te.Locale.EN]=ce.enUS,o[te.Locale.ZH]=ce.zhCN,"undefined"!=typeof performance&&performance.now?performance.now.bind(performance):Date.now,!__SERVER__&&document.documentElement.style,Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e}),se=function(e,n,t,r){return new(t||(t=Promise))(function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function c(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?o(e.value):new t(function(n){n(e.value)}).then(i,c)}u((r=r.apply(e,n||[])).next())})},le=function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;i;)try{if(t=1,r&&(o=r[2&a[0]?"return":a[0]?"throw":"next"])&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[0,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=n.call(e,i)}catch(e){a=[6,e],r=0}finally{t=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},fe=function(e,n){return e>n?1:e<n?-1:0},pe={zh:"zh-cn",en:"en"},de=function(e,n){return se(void 0,void 0,void 0,function(){var n,t,r,o,a,i,c,u;return le(this,function(s){switch(s.label){case 0:return n=e.query,t=n.source,(r=n.sourceText)?process.env.GOOGLE_TRANSLATE_ENABLED?[4,J()(r,{from:pe[t],to:ae[t]})]:[3,2]:[2];case 1:return o=s.sent(),e.body=Object.assign(o,{text:o.text.replace(/<code>([^<>]+)<\/\w+> Code>/g,"<code>$1</code>").replace(/<\/g> -([^<>]+)>/g,"</g-$1>").replace(/<\/ ([^<>]+)>/g,"</$1>")}),[2];case 2:return l={source:t||e.cookies.get("LOCALE_COOKIE"),sourceText:r},a=ue({Action:"TextTranslate",Region:"ap-shanghai",SecretId:process.env.TENCENT_TRANSLATE_API_SECRET_ID,SignatureMethod:"HmacSHA256",Timestamp:Math.ceil(Date.now()/1e3),Nonce:Math.ceil(Math.random()*Number.MAX_SAFE_INTEGER)},l,{target:ae[l.source]}),i=X.a.createHmac("sha256",process.env.TENCENT_TRANSLATE_API_SECRET_KEY).update("GETtmt.api.qcloud.com/v2/index.php?"+ee.a.stringify(a,{encode:!1,sort:fe})).digest("base64"),[4,H.a.get("https://tmt.api.qcloud.com/v2/index.php",{params:Object.assign(a,{Signature:i})})];case 3:return c=s.sent().data,u=c.targetText,e.body=ue({},c,{targetText:u&&u.replace(/\<([^<>]+)\>/g,function(e,n){var t=(n=n.toLowerCase().replace(/ /g,"").replace(/\/+/g,"/")).indexOf("/");return-1!==t&&(n=n.substr(t)),"<"+n+">"})}),[2]}var l})})},he=function(e,n){return Object.defineProperty?Object.defineProperty(e,"raw",{value:n}):e.raw=n,e},ve=function(e,n,t,r){return new(t||(t=Promise))(function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function c(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?o(e.value):new t(function(n){n(e.value)}).then(i,c)}u((r=r.apply(e,n||[])).next())})},ge=function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;i;)try{if(t=1,r&&(o=r[2&a[0]?"return":a[0]?"throw":"next"])&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[0,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=n.call(e,i)}catch(e){a=[6,e],r=0}finally{t=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};global.fetch=F.a;var be=l()("1stg:server:router"),ye=new K.a({prefix:"/api"}),xe=["GITHUB_EXCLUDED_LABELS","GITHUB_EXCLUDED_REPOSITORY_OWNERS"],we=["GITHUB_REPOSITORY_OWNER","GITHUB_REPOSITORY_OWNER_TYPE","GITHUB_REPOSITORY_NAME","GITHUB_CLIENT_ID","GITHUB_OAUTH_CALLBACK"].concat(xe);ye.get("/fetchInfo",function(e,n){var t,r=e.session.user;r||(t=$()(),e.session.uuid=t),e.body={user:r||{uuid:t},envs:we.reduce(function(e,n){var t,r=process.env[n];return xe.includes(n)&&(r=r?r.split(","):[]),Object.assign(e,((t={})[n]=process.env[n],t))},{})}}).get("/oauth",function(e,n){return ve(void 0,void 0,void 0,function(){var n,t,r,o,a,i,c;return ge(this,function(u){switch(u.label){case 0:return n=e.query,t=n.code,r=n.path,(o=n.state)&&o===e.session.uuid?[4,H.a.post("https://github.com/login/oauth/access_token",{client_id:process.env.GITHUB_CLIENT_ID,client_secret:process.env.GITHUB_CLIENT_SECRET,code:t,state:o},{headers:{Accept:"application/json"}})]:[2,e.throw("invalid oauth redirect")];case 1:return(a=u.sent().data).error?[2,e.throw(a)]:(i=a.access_token,e.session.token=i,[4,new P.a({link:Object(G.createHttpLink)({uri:"https://api.github.com/graphql",headers:{Authorization:"bearer "+i}}),cache:new R.InMemoryCache}).query({query:B()(Ee||(Ee=he(["\n        query {\n          viewer {\n            avatarUrl\n            id\n            login\n            name\n            url\n            websiteUrl\n          }\n        }\n      "],["\n        query {\n          viewer {\n            avatarUrl\n            id\n            login\n            name\n            url\n            websiteUrl\n          }\n        }\n      "])))})]);case 2:return c=u.sent().data,e.session.user=c.viewer,e.redirect(""+r.replace(/ /g,"%2B")),[2]}})})}).get("/translate",de);var Ee,me=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e},Te=function(e,n,t,r){return new(t||(t=Promise))(function(o,a){function i(e){try{u(r.next(e))}catch(e){a(e)}}function c(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){e.done?o(e.value):new t(function(n){n(e.value)}).then(i,c)}u((r=r.apply(e,n||[])).next())})},_e=function(e,n){var t,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;i;)try{if(t=1,r&&(o=r[2&a[0]?"return":a[0]?"throw":"next"])&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[0,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=n.call(e,i)}catch(e){a=[6,e],r=0}finally{t=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};u.a.languages(ie);var Oe,qe=l()("1stg:server"),ke=new p.a;ke.keys=(process.env.APP_KEYS||"").split(",");var Le=i.a.readFileSync(S("dist/template.html"),"utf-8"),Ie=[w()(),function(e,n){return Te(void 0,void 0,void 0,function(){var t,r,o,a,i,c;return _e(this,function(s){switch(s.label){case 0:return t=e.url,"GET"!==e.method||t.lastIndexOf(".")>t.lastIndexOf("/")||!["*/*","text/html"].find(function(n){return e.get("Accept").includes(n)})||/^\/(api|graphql)($|\/)/.test(e.url)?[2,n()]:[4,void 0];case 1:return s.sent(),r=Date.now(),o=e.cookies.get("LOCALE_COOKIE"),a=o||u.a.get(e.get("Accept-Language")),o||e.cookies.set("LOCALE_COOKIE",a,{httpOnly:!1,path:"/",expires:new Date("Fri, 31 Dec 9999 23:59:59 GMT")}),i={ctx:e,locale:a,title:"1stG Blog"},e.respond=!1,e.status=200,e.set({"Content-Type":"text/html"}),c=e.res,Oe.renderToStream(i).on("error",function(n){switch(e.status=n.status||500){case 302:return e.set({Location:n.url}),c.end();case 401:return e.redirect("/login?next="+t),c.end();case 404:return c.end("404 | Page Not Found");default:c.end("500 | Internal Server Error"),qe("error during render : "+t),console.error(n.stack)}}).on("end",function(){qe("whole request: "+(Date.now()-r)+"ms")}).pipe(c),[2]}})})}],Ae=_()("public",{maxAge:31536e6}),Se=m()({},ke);i.a,Ne=N(S("dist/vue-ssr-server-bundle.json")),Re={clientManifest:N(S("dist/vue-ssr-client-manifest.json"))},Oe=Object(k.createBundleRenderer)(Ne,me({},Re,{template:Le,inject:!1,cache:q()({max:1e3,maxAge:9e5}),basedir:S("dist/static"),runInNewContext:!1}));var Ne,Re,Ce={};Ie.splice.apply(Ie,[1,0,y()(),Ae,_()("dist/static",{maxAge:31536e6},Ce),Se].concat(function(e){var n=!!e,t=[M()(),ye.routes(),ye.allowedMethods()];if(e||((e=new p.a).keys=e.keys=(process.env.APP_KEYS||"").split(","),t.unshift(m()({},e))),n)return t;e.use(g()(t)),e.listen(A+1,"localhost",function(){be("Router server is now running at %s:%s","localhost",A+1)})}(ke))),Ce["/service-worker.js"].maxAge=0,Ie.push(h()("api.github.com/graphql",{filter:function(e){return"/graphql"===e.url},https:!0,proxyReqOptDecorator:function(e,n){return e.headers.Authorization="bearer "+(n.session.token||process.env.GITHUB_TOKEN),e}})),ke.use(g()(Ie)),ke.listen(A,"localhost",function(){qe("Server is now running at %s:%s","localhost",A)})}]);