module.exports=function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=6)}([function(e,t){e.exports=require("debug")},function(e,t){e.exports=require("koa")},function(e,t){e.exports=require("koa-compose")},function(e,t){e.exports=require("koa-session")},function(e,t,n){"use strict";n.d(t,"c",function(){return o}),n.d(t,"d",function(){return i}),n.d(t,"a",function(){return u}),n.d(t,"b",function(){return c});var r=n(15),o=(n.n(r),"localhost"),i=7e3,u=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r.resolve.apply(r,[process.cwd()].concat(e))},c=require},function(e,t,n){"use strict";n.d(t,"a",function(){return i}),n.d(t,"b",function(){return u}),n.d(t,"c",function(){return o});var r;process.env.GITHUB_REPOSITORY_NAME,process.env.GITHUB_REPOSITORY_OWNER,function(e){e.user="user",e.organization="organization"}(r||(r={}));var o,i=(process.env.GITHUB_REPOSITORY_OWNER_TYPE,r.user,"Fri, 31 Dec 9999 23:59:59 GMT"),u="LOCALE_COOKIE";!function(e){e.EN="en",e.ZH="zh"}(o||(o={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),o=(n.n(r),n(8)),i=n.n(o),u=n(0),c=(n.n(u),n(1)),a=(n.n(c),n(9)),s=(n.n(a),n(2)),l=(n.n(s),n(10)),f=(n.n(l),n(11)),p=(n.n(f),n(3)),h=(n.n(p),n(12)),d=(n.n(h),n(13)),b=(n.n(d),n(14)),v=(n.n(b),n(4)),g=n(16),x=n(26),y=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},w=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function u(e){try{a(r.next(e))}catch(e){i(e)}}function c(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(u,c)}a((r=r.apply(e,t||[])).next())})},q=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,i&&(u=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(u=u.call(i,n[1])).done)return u;switch(i=0,u&&(n=[0,u.value]),n[0]){case 0:case 1:u=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,i=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(u=a.trys,!(u=u.length>0&&u[u.length-1])&&(6===n[0]||2===n[0])){a=0;continue}if(3===n[0]&&(!u||n[1]>u[0]&&n[1]<u[3])){a.label=n[1];break}if(6===n[0]&&a.label<u[1]){a.label=u[1],u=n;break}if(u&&a.label<u[2]){a.label=u[2],a.ops.push(n);break}u[2]&&a.ops.pop(),a.trys.pop();continue}n=t.call(e,a)}catch(e){n=[6,e],i=0}finally{o=u=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,i,u,c,a={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return c={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c},O=this;i.a.languages([x.c.ZH,x.c.EN]);var m=process.env,_=m.APP_KEYS,k=m.GITHUB_TOKEN,j=u("1stg:server"),E=new c;E.keys=_.split(",");var T,I=r.readFileSync(Object(v.a)("dist/template.html"),"utf-8"),P=[f(),function(e,t){return w(O,void 0,void 0,function(){var n,r,o,u,c,a,s;return q(this,function(l){switch(l.label){case 0:return n=e.url,"GET"!==e.method||n.lastIndexOf(".")>n.lastIndexOf("/")||!["*/*","text/html"].find(function(t){return e.get("Accept").includes(t)})||/^\/(api|graphql)($|\/)/.test(e.url)?[2,t()]:[4,void 0];case 1:return l.sent(),r=Date.now(),o=e.cookies.get(x.b),u=o||i.a.get(e.get("Accept-Language")),o||e.cookies.set(x.b,u,{httpOnly:!1,path:"/",expires:new Date(x.a)}),c={ctx:e,locale:u,title:"Blog | Blog system built on GitHub API with Vue SSR"},e.respond=!1,e.status=200,e.set({"Content-Type":"text/html"}),a=e.res,s=T.renderToStream(c).on("error",function(t){switch(e.status=t.status||500){case 302:return e.set({Location:t.url}),a.end();case 401:return e.redirect("/login?next="+n),a.end();case 404:return a.end("404 | Page Not Found");default:a.end("500 | Internal Server Error"),j("error during render : "+n),console.error(t.stack)}}).on("end",function(){j("whole request: "+(Date.now()-r)+"ms")}),s.pipe(a),[2]}})})}],S=p({},E);T=function(e,t){return Object(b.createBundleRenderer)(e,y({},t,{template:I,cache:d({max:1e3,maxAge:9e5}),basedir:Object(v.a)("dist/static"),runInNewContext:!1}))}(Object(v.b)(Object(v.a)("dist/vue-ssr-server-bundle.json")),{clientManifest:Object(v.b)(Object(v.a)("dist/vue-ssr-client-manifest.json"))});var A={};P.splice.apply(P,[1,0,l(),h(Object(v.a)("dist/static"),{maxAge:31536e6},A),S].concat(Object(g.a)(E))),A["/service-worker.js"].maxAge=0,P.push(a("api.github.com/graphql",{filter:function(e){return"/graphql"===e.url},https:!0,proxyReqOptDecorator:function(e,t){return e.headers.Authorization="bearer "+(t.session.token||k),e}})),E.use(s(P)),E.listen(v.d,v.c,function(){j("Server is now running at %s:%s",v.c,v.d)})},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("accept-language")},function(e,t){e.exports=require("koa-better-http-proxy")},function(e,t){e.exports=require("koa-compress")},function(e,t){e.exports=require("koa-logger")},function(e,t){e.exports=require("koa-static-cache")},function(e,t){e.exports=require("lru-cache")},function(e,t){e.exports=require("vue-server-renderer")},function(e,t){e.exports=require("path")},function(e,t,n){"use strict";var r=n(17),o=(n.n(r),n(18)),i=n.n(o),u=n(19),c=(n.n(u),n(20)),a=n.n(c),s=n(0),l=(n.n(s),n(21)),f=n.n(l),p=n(1),h=(n.n(p),n(22)),d=(n.n(h),n(2)),b=(n.n(d),n(23)),v=(n.n(b),n(3)),g=(n.n(v),n(24)),x=n.n(g),y=n(25),w=(n.n(y),n(4)),q=this&&this.__makeTemplateObject||function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},O=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function u(e){try{a(r.next(e))}catch(e){i(e)}}function c(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(u,c)}a((r=r.apply(e,t||[])).next())})},m=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,i&&(u=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(u=u.call(i,n[1])).done)return u;switch(i=0,u&&(n=[0,u.value]),n[0]){case 0:case 1:u=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,i=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(u=a.trys,!(u=u.length>0&&u[u.length-1])&&(6===n[0]||2===n[0])){a=0;continue}if(3===n[0]&&(!u||n[1]>u[0]&&n[1]<u[3])){a.label=n[1];break}if(6===n[0]&&a.label<u[1]){a.label=u[1],u=n;break}if(u&&a.label<u[2]){a.label=u[2],a.ops.push(n);break}u[2]&&a.ops.pop(),a.trys.pop();continue}n=t.call(e,a)}catch(e){n=[6,e],i=0}finally{o=u=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,i,u,c,a={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return c={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c},_=this;global.fetch=x.a;var k=process.env,j=k.APP_KEYS,E=k.GITHUB_CLIENT_ID,T=k.GITHUB_CLIENT_SECRET,I=s("1stg:server:router"),P=new b({prefix:"/api"});P.get("/user",function(e,t){var n,r=e.session.user;r||(n=y(),e.session.uuid=n),e.body=r||{uuid:n}}).get("/oauth",function(e,t){return O(_,void 0,void 0,function(){var t,n,o,c,s,l,p,h;return m(this,function(d){switch(d.label){case 0:return t=e.query,n=t.code,o=t.path,c=t.state,c&&c===e.session.uuid?[4,a.a.post("https://github.com/login/oauth/access_token",{client_id:E,client_secret:T,code:n,state:c},{headers:{Accept:"application/json"}})]:[2,e.throw("invalid oauth redirect")];case 1:return s=d.sent().data,s.error?[2,e.throw(s)]:(l=s.access_token,e.session.token=l,p=new i.a({link:Object(u.createHttpLink)({uri:"https://api.github.com/graphql",headers:{Authorization:"bearer "+l}}),cache:new r.InMemoryCache}),[4,p.query({query:f()(S||(S=q(["\n        query {\n          viewer {\n            avatarUrl\n            id\n            login\n            name\n            url\n            websiteUrl\n          }\n        }\n      "],["\n        query {\n          viewer {\n            avatarUrl\n            id\n            login\n            name\n            url\n            websiteUrl\n          }\n        }\n      "])))})]);case 2:return h=d.sent().data,e.session.user=h.viewer,e.redirect(""+o.replace(/ /g,"%2B")),[2]}})})}),t.a=function(e){var t=!!e,n=[h(),P.routes(),P.allowedMethods()];if(e||(e=new p,e.keys=e.keys=j.split(","),n.unshift(v({},e))),t)return n;e.use(d(n)),e.listen(w.d+1,w.c,function(){I("Router server is now running at %s:%s",w.c,w.d+1)})};var S},function(e,t){e.exports=require("apollo-cache-inmemory")},function(e,t){e.exports=require("apollo-client")},function(e,t){e.exports=require("apollo-link-http")},function(e,t){e.exports=require("axios")},function(e,t){e.exports=require("graphql-tag")},function(e,t){e.exports=require("koa-bodyparser")},function(e,t){e.exports=require("koa-router")},function(e,t){e.exports=require("node-fetch")},function(e,t){e.exports=require("uuid")},function(e,t,n){"use strict";var r=(n(27),n(29),n(5));n.d(t,"a",function(){return r.a}),n.d(t,"b",function(){return r.b}),n.d(t,"c",function(){return r.c}),n(30)},function(e,t,n){"use strict";var r=n(28);n.n(r).a},function(e,t){e.exports=require("invert-color")},function(e,t,n){"use strict";n(5)},function(e,t,n){"use strict";var r=n(31);n.n(r)},function(e,t){e.exports=require("date-fns")}]);